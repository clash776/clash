<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>おしまい</title>
  <script type="module" crossorigin src="/my-app/assets/main1-DKnhThjR.js"></script>
  <link rel="stylesheet" crossorigin href="/my-app/assets/main1-C9ua35nR.css">
</head>

<body>
  <div class="main-layout">
    <div class="sidebar">
      <nav
        style="display: flex; position:absolute; top: 200px; flex-direction: column; align-items: center; gap: 16px;">
        <to-chapter-howtouse></to-chapter-howtouse>
        <to-chapter-1></to-chapter-1>
        <to-chapter-2></to-chapter-2>
        <to-chapter-3></to-chapter-3>
        <to-chapter-4></to-chapter-4>
        <to-chapter-5></to-chapter-5>
        <to-chapter-6></to-chapter-6>
        <to-test-1></to-test-1>
        <a href="#" style="color: #fff;text-decoration: none; font-weight: bold; font-size: 25px;">おしまい</a>
      </nav>
    </div>
    <div class="main-content">
      <div id="page1" style="display:block;">
        <h2>これで教材の内容はすべて終了です。お疲れさまでした。</h2>
        <p>
          この後、学習内容の理解を確認するための<b>事後テスト</b>があります。
          難しく考えず、教材で行った操作や説明を思い出しながら回答してください。
        </p>
        <p>事後テストの前に確認したいことがある場合は、各章へ戻って確認したり、下のシミュレータを利用して確認しましょう。</p>
        <p><b>事後テスト終了後、教材に関するアンケートにご協力をお願いします。</b></p>
        <button onclick="openGoogleForm()">アンケートページへ</button>
        <p></p>
        <div class="app-container">
          <!-- wokwiオブジェクト部分はそのまま -->
          <div class="leds-circuit" style="position: relative; width: 500px; height: 550px; margin: 0 auto;">
            <my-breadboard style="display:block; position:absolute; top:0px; left:0px;"></my-breadboard>
            <!-- LEDを中央上に配置 -->
            <wokwi-7segment id="segment" color="red" values="[0,0,0,0,0,0,0,0]" pins="extend"
              style="position: absolute; left: 269px; top: 111px; transform: scale(1.56, 1.28);"></wokwi-7segment>
            <!-- Arduino Unoを中央下に配置 -->
            <wokwi-resistor value="200" style="position: absolute; left: 308px; top: 219px;"></wokwi-resistor>
            <wokwi-resistor value="200"
              style="position: absolute; left: 225px; top: 203px; transform: rotate(212deg);"></wokwi-resistor>
            <wokwi-resistor value="200" style="position: absolute; left: 203px; top: 219px;"></wokwi-resistor>
            <wokwi-resistor value="200" style="position: absolute; left: 308px; top: 79px;"></wokwi-resistor>
            <wokwi-resistor value="200" style="position: absolute; left: 323px; top: 64px;"></wokwi-resistor>
            <wokwi-resistor value="200" style="position: absolute; left: 218px; top: 79px;"></wokwi-resistor>
            <wokwi-resistor value="200" style="position: absolute; left: 203px; top: 64px;"></wokwi-resistor>
            <wokwi-led id="circuit-led" color="red" pin="11"
              style="position: absolute; left: 100px; top: 145px; transform: scale(1.5);"></wokwi-led>
            <wokwi-resistor value="200" style="position: absolute; left: 53px; top: 204px;"></wokwi-resistor>

            <wokwi-arduino-uno id="circuit-arduino"
              style="position: absolute; left: 110px; top: 330px;"></wokwi-arduino-uno>
            <!-- 回路の線をSVGで描画（LEDの足からArduinoの7番ピン/GNDへ） -->
            <svg width="500" height="340" style="position: absolute; left: 0; top: 0;">
              <!-- 2番ピンへ -->
              <line x1="367" y1="99" x2="405" y2="99" stroke="red" stroke-width="3" />
              <line x1="403" y1="99" x2="403" y2="300" stroke="red" stroke-width="3" />
              <line x1="403" y1="299" x2="370" y2="299" stroke="red" stroke-width="3" />
              <line x1="370" y1="299" x2="345" y2="340" stroke="red" stroke-width="3" />
              <!-- 3番ピンへ -->
              <line x1="381" y1="84" x2="420" y2="84" stroke="red" stroke-width="3" />
              <line x1="418" y1="84" x2="418" y2="295" stroke="red" stroke-width="3" />
              <line x1="418" y1="293" x2="406" y2="293" stroke="red" stroke-width="3" />
              <line x1="400" y1="293" x2="365" y2="293" stroke="red" stroke-width="3" />
              <line x1="365" y1="293" x2="335" y2="340" stroke="red" stroke-width="3" />
              <!-- 4番ピンへ -->
              <line x1="368" y1="209" x2="392" y2="209" stroke="red" stroke-width="3" />
              <line x1="390" y1="209" x2="390" y2="286" stroke="red" stroke-width="3" />
              <line x1="392" y1="286" x2="360" y2="286" stroke="red" stroke-width="3" />
              <line x1="360" y1="286" x2="325" y2="340" stroke="red" stroke-width="3" />
              <!-- 5番ピンへ -->
              <line x1="233" y1="179" x2="225" y2="179" stroke="red" stroke-width="3" />
              <line x1="227" y1="179" x2="227" y2="218" stroke="red" stroke-width="3" />
              <line x1="227" y1="231" x2="227" y2="240" stroke="red" stroke-width="3" />
              <line x1="225" y1="240" x2="320" y2="240" stroke="red" stroke-width="3" />
              <line x1="318" y1="240" x2="318" y2="340" stroke="red" stroke-width="3" />
              <!-- 6番ピンへ -->
              <line x1="203" y1="209" x2="193" y2="209" stroke="red" stroke-width="3" />
              <line x1="195" y1="209" x2="195" y2="260" stroke="red" stroke-width="3" />
              <line x1="193" y1="260" x2="310" y2="260" stroke="red" stroke-width="3" />
              <line x1="308" y1="260" x2="308" y2="340" stroke="red" stroke-width="3" />
              <!-- 7番ピンへ -->
              <line x1="218" y1="99" x2="180" y2="99" stroke="red" stroke-width="3" />
              <line x1="182" y1="99" x2="182" y2="270" stroke="red" stroke-width="3" />
              <line x1="180" y1="270" x2="300" y2="270" stroke="red" stroke-width="3" />
              <line x1="298" y1="270" x2="298" y2="340" stroke="red" stroke-width="3" />
              <!-- 8番ピンへ -->
              <line x1="203" y1="84" x2="165" y2="84" stroke="red" stroke-width="3" />
              <line x1="167" y1="84" x2="167" y2="280" stroke="red" stroke-width="3" />
              <line x1="165" y1="280" x2="286" y2="280" stroke="red" stroke-width="3" />
              <line x1="284" y1="280" x2="284" y2="340" stroke="red" stroke-width="3" />
              <!-- GNDへ -->
              <line x1="292" y1="84" x2="292" y2="40" stroke="black" stroke-width="3" />
              <line x1="292" y1="40" x2="150" y2="40" stroke="black" stroke-width="3" />
              <line x1="152" y1="40" x2="152" y2="270" stroke="black" stroke-width="3" />

              <line x1="32" y1="270" x2="32" y2="320" stroke="black" stroke-width="3" />
              <line x1="31" y1="320" x2="227" y2="320" stroke="black" stroke-width="3" />
              <line x1="226" y1="320" x2="226" y2="340" stroke="black" stroke-width="3" />

              <line x1="53" y1="223" x2="47" y2="270" stroke="black" stroke-width="3" />
              <line x1="127" y1="223" x2="127" y2="300" stroke="red" stroke-width="3" />
              <line x1="126" y1="300" x2="257" y2="300" stroke="red" stroke-width="3" />
              <line x1="255" y1="300" x2="255" y2="340" stroke="red" stroke-width="3" />
            </svg>
          </div>
          <p></p>
          <div class="editor-container" style="width: 900px; height: 350px; display: flex;">
            <div class="code-editor-container" style="width: 500px; height: 300px;">
              <div class="toolbar">
                <button id="run-button1">Run</button>
                <button id="stop-button1" disabled>Stop</button>
                <div class="spacer"></div>
                <div id="status-label1"></div>
              </div>
              <div class="code-editor" id="editor1"></div>
            </div>
            <div class="serial-monitor-container" style="width: 400px; height: 300px;">
              <div class="bar"
                style="width: 400px; height: 30px; background-color: #888888; box-sizing: border-box; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: bold; font-size: 1.1em; letter-spacing: 1px;">
                Serial Monitor　(9600bps)　
              </div>
              <div class="serial-monitor"
                style="width: 400px; height: 300px; box-sizing: border-box; border: 1px solid grey;">
                <pre id="serial-monitor-text1"></pre>
              </div>
            </div>
          </div>
          <div class="compiler-output">
            <pre id="compiler-output-text1"></pre>
          </div>
          <div class="error-output">
            <pre id="error-output-text1"></pre>
          </div>
        </div>
      </div>
    </div>
    <div class="sidebar"></div>
  </div>
  <script>
    const readOnly = false;
    let selected_editor = '#editor1';
    document.addEventListener('DOMContentLoaded', function () {
      // ページコード全体をローカルストレージから復元
      const codesAll = localStorage.getItem('pagefinal_codes_all');
      if (codesAll) {
        try {
          const parsed = JSON.parse(codesAll);
          if (parsed && typeof parsed === 'object') {
            Object.keys(PAGE_CODES).forEach(key => {
              if (parsed[key]) PAGE_CODES[key] = parsed[key];
            });
          }
        } catch (e) { }
      }

      // 各Runボタンにイベント登録
      ['run-button1'].forEach((btnId, idx) => {
        const btn = document.getElementById(btnId);
        if (btn) {
          btn.addEventListener('click', function () {
            // 現在のエディタのコードを取得して保存
            let code = editor.getModel().getValue();
            PAGE_CODES['page' + (idx + 1)] = code;
            // ローカルストレージに保存
            localStorage.setItem('pagefinal_codes_all', JSON.stringify(PAGE_CODES));
            console.log(code);
          });
        }
      });
    });
    const PAGE_CODES = {
      page1: `
void setup() {
    pinMode(11, OUTPUT);             
}
void loop() {
    digitalWrite(11, HIGH); 
}
`.trim(),
    };

    document.addEventListener('DOMContentLoaded', function () {
      window.setActiveButtons('run-button1', 'stop-button1', 'status-label1', 'compiler-output-text1', 'error-output-text1', 'serial-monitor-text1');
      window.INITIAL_CODE = PAGE_CODES['page1'];
      document.querySelectorAll('.page-link, .page-nav').forEach(link => {
        link.addEventListener('click', function (e) {
          e.preventDefault();
          const toPage = this.dataset.to || this.dataset.page;
          showPage(toPage, this);
        });
      });
      window.markChapterUnlocked(8);

      const chaptertest_start = parseInt(localStorage.getItem('chaptertest_start'));
      const end = Date.now();
      const diffMs = end - chaptertest_start; // 経過ミリ秒
      const diffSec = Math.floor(diffMs / 1000); // 経過秒
      localStorage.setItem('chaptertest_time', diffSec);
      localStorage.removeItem('chaptertest_start');
    });


    function openGoogleForm() {
      // ここで送信したい値を変数で用意
      const val1 = ''; // entry.864638212
      const val2 = ''; // entry.1368732382
      // チャプター1～6とテストのタイムを空白区切りでval3に格納
      const val3 = [
        localStorage.getItem('chapter1_time') || '',
        localStorage.getItem('chapter2_time') || '',
        localStorage.getItem('chapter3_time') || '',
        localStorage.getItem('chapter4_time') || '',
        localStorage.getItem('chapter5_time') || '',
        localStorage.getItem('chapter6_time') || '',
        localStorage.getItem('chaptertest_time') || ''
      ].join(' ');
      const val4 = ''; // entry.2085820087
      // Googleフォームの事前入力リンクを組み立て
      const url = 'https://docs.google.com/forms/d/e/1FAIpQLSdFGnpoKfmbs_KbBtaxJzevw9Ar465Ge1J7WwANI6vVMsnupA/viewform?usp=pp_url'
        + '&entry.864638212=' + encodeURIComponent(val1)
        + '&entry.1368732382=' + encodeURIComponent(val2)
        + '&entry.802561133=' + encodeURIComponent(val3)
        + '&entry.2085820087=' + encodeURIComponent(val4)
        + '&pageHistory=0,1';
      window.open(url, '_blank'); // 新しいタブで開く
    }
  </script>
</body>
</div>

</html>